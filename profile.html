<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zone Vault</title>
  <!-- You can keep main.js if it contains other logic, otherwise it's optional -->
  <script src="main.js"></script>
   
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="favicon-new.png" type="image/png">
  <meta name="theme-color" content="#2196f3">

  <meta name="title" content="Zone Vault">
  <meta name="description" content="New Arrival! SEVENTEEN: OUR CHAPTER is finally here! Don’t wait—watch SEVENTEEN: OUR CHAPTER now and enjoy it all!">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://zonevault.site/index">
  <meta property="og:title" content="Zone Vault">
  <meta property="og:description" content="New Arrival! SEVENTEEN: OUR CHAPTER is finally here! Don’t wait—watch SEVENTEEN: OUR CHAPTER now and enjoy it all!">
  <meta property="og:image" content="https://uploads.onecompiler.io/43ddry4jt/43s3sjvch/Zone%20Vault%20logo.png">
  <meta property="og:site_name" content="Zone Vault">
  <meta property="og:locale" content="en_PH">

  <!-- Twitter / X Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://zonevault.site/index">
  <meta name="twitter:title" content="Zone Vault">
  <meta name="twitter:description" content="New Arrival! SEVENTEEN: OUR CHAPTER is finally here! Don’t wait—watch SEVENTEEN: OUR CHAPTER now and enjoy it all!">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/svtzoneph/gallery/main/images/website/Trailer -Cover.jpg">
  <meta name="twitter:site" content="@101_livestream">

  <meta name="apple-mobile-web-app-title" content="Zone Vault">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a1a1a">
  <link rel="apple-touch-icon" sizes="192x192" href="https://raw.githubusercontent.com/svtzoneph/gallery/main/images/website/Trailer -Cover.jpg">
  <link rel="apple-touch-icon" sizes="512x512" href="https://raw.githubusercontent.com/svtzoneph/gallery/main/images/website/Trailer -Cover.jpg">
  <link rel="apple-touch-startup-image" href="splash.png">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1B2RJ659GL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-1B2RJ659GL');
  </script>
   
  <style>
      * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      background: radial-gradient(circle at top, #0a0a0a, #000);
      color: #fff;
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    main { flex: 1; }

    /* === ANIMATED BACKGROUND GRADIENT === */
    body::before {
      content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(-45deg, #000, #111, #222, #000);
      background-size: 400% 400%; animation: gradientFlow 10s ease infinite; z-index: 0;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
    }

    /* === PARTICLES & GLOW === */
    .particle {
      position: fixed; background: rgba(255,255,255,0.1); border-radius: 50%;
      animation: floatUp linear infinite; z-index: 0; pointer-events: none;
    }
    @keyframes floatUp {
      0% { transform: translateY(0) scale(1); opacity: 0.2; }
      50% { transform: translateY(-50vh) scale(1.3); opacity: 0.4; }
      100% { transform: translateY(-100vh) scale(0.8); opacity: 0; }
    }
    .circle {
      position: absolute; border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: float 15s infinite ease-in-out; z-index: 0;
    }
    .circle:nth-child(1) { width: 300px; height: 300px; top: 15%; left: 10%; }
    .circle:nth-child(2) { width: 250px; height: 250px; bottom: 20%; right: 12%; animation-delay: 3s; }
    .circle:nth-child(3) { width: 200px; height: 200px; top: 55%; right: 25%; animation-delay: 6s; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    
    #particle-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }

    /* === HEADER === */
    header {
      width: 100%; position: fixed; top: 0; left: 0; z-index: 100;
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px 35px; background: transparent; transition: background 0.4s ease;
    }
    header.scrolled { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); }
    .logo img { height: 45px; width: auto; transition: transform 0.3s ease; z-index: 2; }
    .logo img:hover { transform: scale(1.05); }
    .header-buttons { display: flex; align-items: center; gap: 12px; z-index: 2; }
    .header-btn {
      padding: 10px 25px; border: 2px solid #fff; background: transparent; color: #fff;
      border-radius: 30px; font-weight: 500; cursor: pointer; transition: all 0.3s ease;
      z-index: 2; text-decoration: none;
    }
    .header-btn:hover { background: #fff; color: #000; transform: scale(1.05); }

    /* === HERO === */
    .welcome {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 2; height: 100vh; text-align: center; padding: 0 20px;
    }
    .welcome h1 {
      font-size: clamp(2rem, 5vw, 4rem); text-transform: uppercase; letter-spacing: 3px;
      margin-bottom: 15px; background: linear-gradient(90deg, #fff, #999);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.4); animation: fadeIn 1s ease forwards;
    }
    .welcome p {
      max-width: 650px; color: #aaa; font-size: clamp(1rem, 3vw, 1.2rem);
      line-height: 1.7; opacity: 0; animation: fadeIn 1.2s ease forwards 0.2s;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* === MODALS === */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(0.5px);
      display: flex; justify-content: center; align-items: center;
      z-index: 999; animation: fadeModal 0.3s ease;
    }
    @keyframes fadeModal { from { opacity: 0; } to { opacity: 1; } }
    .modal {
      background: #111; border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
      width: 90%; max-width: 400px; position: relative; animation: popIn 0.3s ease;
    }
    @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .modal-header {
      background: linear-gradient(90deg, #fff, #999); color: #000; padding: 15px;
      font-weight: 700; display: flex; justify-content: space-between;
      border-radius: 20px 20px 0 0;
    }
    .close-btn { font-size: 24px; cursor: pointer; color: #000; }
    .modal-content { padding: 25px; text-align: center; }
    .modal-content p { color: #bbb; margin-bottom: 20px; }
    .modal button {
      width: 100%; padding: 12px; border-radius: 25px; border: 2px solid #fff;
      background: transparent; color: #fff; font-weight: 600; cursor: pointer; margin: 8px 0;
    }
    .modal button:hover { background: #fff; color: #000; }

    /* === ABOUT MODAL === */
    #aboutModal .modal { max-width: 650px; max-height: 80vh; display: flex; flex-direction: column; }
    #aboutModal .modal-content { overflow-y: auto; text-align: justify; color: #ccc; }
    #aboutModal h3 { color: #fff; margin-top: 1.5rem; }
    #aboutModal ul { padding-left: 20px; margin-bottom: 1.5rem; }

    /* === RESPONSIVE === */
    @media (max-width: 600px) {
      header { flex-direction: row; padding: 10px 20px; }
      .header-buttons { gap: 8px; }
      .logo img { height: 35px; }
      .header-btn { padding: 8px 14px; font-size: 0.85rem; }
    }
  </style>
</head>
<body>

  <div class="circle"></div>
  <div class="circle"></div>
  <div class="circle"></div>
  <div id="particle-container"></div>

  <!-- PARTICLE SCRIPT -->
  <script>
    const container = document.getElementById("particle-container");
    const colors = ["#fff", "#000", "#888", "#444"]; 
    const particleCount = 200;
    for(let i = 0; i < particleCount; i++){
      const particle = document.createElement("div");
      particle.classList.add("particle");
      const size = Math.random() * 4 + 2;
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      particle.style.left = `${Math.random() * 100}%`;
      particle.style.top = `${Math.random() * 100}%`;
      particle.style.background = colors[Math.floor(Math.random() * colors.length)];
      particle.style.animationDuration = `${30 + Math.random() * 30}s`;
      particle.style.animationDelay = `${Math.random() * 30}s`;
      container.appendChild(particle);
    }
  </script>

  <header id="navbar">
    <div class="logo">
      <img src="https://uploads.onecompiler.io/43ddry4jt/43s3sjvch/Zone%20Vault%20logo.png" alt="Zone Vault Logo">
    </div>
    <div class="header-buttons">
      <button class="header-btn" onclick="openAbout()">About</button>
      <button class="header-btn" onclick="openModal()">Sign up</button>
      <a href="login.html" class="header-btn">Login</a>
    </div>
  </header>

  <main>
    <div class="welcome">
      <h1>Welcome to Zone Vault</h1>
      <p>Watch, Enjoy, and Stay Private! Enjoy exclusive content in a private, full-featured layout.</p>
    </div>
  </main>

  <!-- Welcome Modal -->
  <div class="modal-overlay" id="welcomeModal" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        Welcome
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-content">
        <p>Please login or register to continue your journey.</p>
        <button onclick="window.location.href='login.html'">Login</button>
        <button onclick="window.location.href='register.html'">Register</button>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div class="modal-overlay" id="aboutModal" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        About Zone Vault
        <span class="close-btn" onclick="closeAbout()">&times;</span>
      </div>
      <div class="modal-content">
        <h2>How Zone Vault Works?</h2>
        <h3>How to Login/Register</h3>
        <p>To join, you must first be part of a <strong>private livestream group</strong>...</p>
        <h3>Additional Guidelines & Tips</h3>
        <ul>
          <li>Use a <strong>modern browser</strong> for the best viewing experience.</li>
          <li>Contact the admin via email for support or technical issues.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- UI Logic Scripts -->
  <script>
    window.onload = function() {
      const modalShown = localStorage.getItem('welcomeModalShown');
      if (!modalShown) {
        openModal();
      }
    };
    function closeModal() {
      document.getElementById("welcomeModal").style.display = "none";
      document.body.style.overflow = "auto";
      localStorage.setItem('welcomeModalShown', 'true');
    }
    function openModal() {
      document.getElementById("welcomeModal").style.display = "flex";
      document.body.style.overflow = "hidden";
    }
    function closeAbout() {
      document.getElementById("aboutModal").style.display = "none";
      document.body.style.overflow = "auto";
    }
    function openAbout() {
      document.getElementById("aboutModal").style.display = "flex";
      document.body.style.overflow = "hidden";
    }
  </script>

  <!-- FIREBASE & NOTIFICATION LOGIC (FIXED) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, set, update, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-messaging.js";

    // 1. GENERATE USER ID FIRST
    let userId = localStorage.getItem("userId");
    if (!userId) {
      userId = "user_" + Math.random().toString(36).substring(2, 10);
      localStorage.setItem("userId", userId);
    }
    console.log("Current User ID:", userId);

    const firebaseConfig = {
      apiKey: "AIzaSyAs2S6iRhnYhmqNuF0QCCYu5NuzxHxIRv0",
      authDomain: "tvnstream-b4497.firebaseapp.com",
      databaseURL: "https://tvnstream-b4497-default-rtdb.firebaseio.com",
      projectId: "tvnstream-b4497",
      storageBucket: "tvnstream-b4497.firebasestorage.app",
      messagingSenderId: "308384754214",
      appId: "1:308384754214:web:2938e76cd29b288f75d4e7",
      measurementId: "G-VFNH70R4D9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messaging = getMessaging(app);
    const vapidKey = "BM9NB-Q0-KYbhwad-5lhztW0BMpRjKBs67IOtQ7uLBZUKgzmmSmPferlpJnyVbmjo4LlvX0cVF2G_zX1OOHldyE";

    // 2. REGISTER SERVICE WORKER AND GET TOKEN
    async function initNotifications() {
      if ('serviceWorker' in navigator) {
        
        // GUARD: Check if running in Preview/Blob mode
        if (window.location.protocol === 'file:' || window.location.protocol === 'data:' || window.location.href.startsWith('blob:')) {
            console.warn('⚠️ Service Worker Registration Skipped: Current environment (Preview/Blob) does not support Service Workers. This will work on your hosted site (zonevault.site).');
            return;
        }

        try {
          // Register sw.js explicitly
          const registration = await navigator.serviceWorker.register('sw.js');
          console.log('Service Worker registered with scope:', registration.scope);

          // Request Permission
          const permission = await Notification.requestPermission();
          if (permission === 'granted') {
            console.log('Notification permission granted.');

            // Get Token using the SPECIFIC registration
            const currentToken = await getToken(messaging, { 
              vapidKey: vapidKey,
              serviceWorkerRegistration: registration 
            });

            if (currentToken) {
              console.log('FCM Token:', currentToken);
              saveTokenToDatabase(currentToken);
            } else {
              console.log('No registration token available.');
            }
          } else {
            console.log('Permission denied for notifications.');
          }
        } catch (err) {
          console.error('An error occurred while retrieving token:', err);
        }
      }
    }

    function saveTokenToDatabase(token) {
      update(ref(db, 'userSessions/' + userId), {
        fcmToken: token,
        notificationsEnabled: true,
        lastTokenUpdate: serverTimestamp()
      });
    }

    // Start the process
    initNotifications();

    // Handle foreground messages
    onMessage(messaging, (payload) => {
      console.log('Message received. ', payload);
      const { title, body, icon } = payload.notification;
      new Notification(title, {
        body: body,
        icon: icon || 'https://uploads.onecompiler.io/43ddry4jt/43s3sjvch/Zone%20Vault%20logo.png'
      });
    });

    // 3. USER TRACKING LOGIC
    const deviceInfo = navigator.userAgent;
    function logActivity(action, details = "") {
      const sessionRef = ref(db, "userSessions/" + userId);
      update(sessionRef, {
        lastAction: action,
        lastDetails: details,
        lastActive: new Date().toLocaleString(),
        device: deviceInfo,
        currentPage: window.location.pathname,
      });
      const activityRef = push(ref(db, "userSessions/" + userId + "/activityLog"));
      set(activityRef, {
        action,
        details,
        timestamp: serverTimestamp(),
        page: window.location.pathname
      });
    }

    logActivity("Page Visit", document.title);
    document.addEventListener("click", (e) => {
      const target = e.target.tagName;
      logActivity("Click", `Clicked on ${target}`);
    });
    window.addEventListener("beforeunload", () => {
      logActivity("Left Page", document.title);
    });
  </script>

  <footer style="width: 100%; color: #ccc; padding: 40px 10px 30px; font-size: 14px; line-height: 1.6; text-align: center;">
    <div style="max-width: 1200px; margin: 0 auto; border-top: 1px solid #333; padding-top: 30px;">
      <p>&copy; 2025 <strong>Zone Vault</strong>. All rights reserved.</p>
    </div>
  </footer>

</body>
</html>
