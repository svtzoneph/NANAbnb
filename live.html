<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VIDEOS</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script> 
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<link rel="icon" href="favicon-new.png" type="image/png" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<meta name="apple-mobile-web-app-title" content="Zone Vault">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" sizes="192x192" href="favicon-new.png">
<link rel="apple-touch-icon" sizes="512x512" href="favicon-new.png">
<link rel="apple-touch-startup-image" href="splash.png">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-1B2RJ659GL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1B2RJ659GL');
</script>

<script>
  (function() {
    const savedTheme = localStorage.getItem('zoneVaultTheme');
    if(savedTheme) {
      const style = document.createElement('style');
      style.innerHTML = `
        body { 
          background: ${savedTheme} !important; 
          background-size: cover !important;
          background-attachment: fixed !important;
          background-repeat: no-repeat !important;
          min-height: 100vh;
        }
      `;
      document.head.appendChild(style);
    }
  })();
</script>

<style>
  /* --- CSS VARIABLES FOR GLASS --- */
  :root {
      --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      --glass-border: 1px solid rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      --glass-blur: blur(20px);
      --text-shadow: 0 1px 2px rgba(0,0,0,0.8);
  }

  * { box-sizing: border-box; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } /* NO TEXT SELECTION */

  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: black;
    text-align: center;
    padding: 20px 0px;
    margin: 0;
    transition: background 0.5s ease;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .center-logo { 
      display: flex; 
      justify-content: center; 
      margin-bottom: 20px; 
      width: 100%;
  }
  .center-logo img { 
      width: 50px; 
      height: auto; 
      border-radius: 12px; 
      box-shadow: 0 8px 20px rgba(0,0,0,0.3); 
  }

  .main-layout {
    max-width: 1100px;
    width: 100%;
    padding: 0 20px; 
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* --- IFRAME RESPONSIVE CONTAINER --- */
  .iframe-container {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
      height: 0;
      box-shadow: var(--glass-shadow);
      background: black;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
  }

  /* Added 'pointer-events: none' to block clicking on iframe to get URL (optional, remove if controls needed) */
  .iframe-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
  }

  h2 {
    font-size: 24px;
    color: white;
    margin-top: 25px;
    margin-bottom: 5px;
    font-weight: 600;
    letter-spacing: 1px;
    text-align: center; 
    text-shadow: var(--text-shadow);
    width: 100%;
  }

  @media (max-width: 600px) {
    h2 { font-size: 18px; margin-top: 15px; }
    .center-logo img { width: 40px; }
    .main-layout { padding: 0 10px; }
  }

  /* --- BACK BUTTON --- */
  .back-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 50px; height: 50px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    text-decoration: none; z-index: 3000;
    transition: all 0.3s ease;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  }
  .back-btn:hover { 
    background: rgba(255,255,255,0.25); 
    transform: scale(1.1); 
    border-color: white; 
  }
  .back-btn svg { display: block; }
  
  /* Access Denied Modal */
  .access-denied-modal {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.95); /* Darker background */
    color: #fff;
    font-family: 'Segoe UI', Arial, sans-serif;
    display: flex; align-items: center; justify-content: center;
    z-index: 99999; text-align: center; padding: 20px;
    opacity: 0; animation: fadeIn 0.5s forwards; flex-direction: column;
    backdrop-filter: blur(20px);
  }
  .access-denied-modal strong { font-size: 24px; margin-bottom: 10px; }
  .access-denied-modal button {
    margin-top: 15px; padding: 10px 25px;
    background: transparent; color: white;
    border: 2px solid white; border-radius: 50px;
    cursor: pointer; font-weight: bold; transition: all 0.3s ease;
  }
  .access-denied-modal button:hover { background: white; color: black; }
  @keyframes fadeIn { to { opacity: 1; } }
</style>
</head>

<body oncontextmenu="return false;">

<div class="center-logo">
  <img src="https://uploads.onecompiler.io/43ddry4jt/43s3sjvch/Zone%20Vault%20logo.png" loading="lazy" alt="Zone Vault Logo">
</div>

<div class="main-layout">
    
    <div class="iframe-container" id="secureVideoContainer">
        <iframe src="https://player.livepush.io/live/emWB8gpZ8_gUc2-t" allowFullScreen="1" frameBorder="0"></iframe>
    </div>

    <h2 id="main-title">SEVENTEEN WORLD TOUR [NEW_] IN OSAKA JAPAN SHOW</h2>

</div> 

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAs2S6iRhnYhmqNuF0QCCYu5NuzxHxIRv0",
  authDomain: "tvnstream-b4497.firebaseapp.com",
  databaseURL: "https://tvnstream-b4497-default-rtdb.firebaseio.com",
  projectId: "tvnstream-b4497",
  storageBucket: "tvnstream-b4497.appspot.com",
  messagingSenderId: "308384754214",
  appId: "1:308384754214:web:2938e76cd29b288f75d4e7",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth(); 
const db = firebase.database();

// =========================================================================
// !!! ENHANCED SECURITY SCRIPT !!!
// =========================================================================
const PAGE_ID = "live_OSAKA_NEW_TOUR"; 

function nukeContent() {
    // Physically remove the video so it stops playing and cannot be inspected
    const videoContainer = document.getElementById('secureVideoContainer');
    if(videoContainer) videoContainer.remove();
}

function showAccessDeniedModal(message) {
    nukeContent(); // DELETE VIDEO IMMEDIATELY
    
    document.body.style.overflow = 'hidden';
    const modal = document.createElement('div');
    modal.className = 'access-denied-modal';
    modal.style.opacity = '1';
    modal.style.animation = 'none';

    modal.innerHTML = `
        <strong style="color: #FF4444; font-size: 36px; margin-bottom: 20px;">ðŸš« Access Denied</strong>
        <div style="margin-top: 15px; font-size: 18px; max-width: 90%; line-height: 1.4; text-shadow: var(--text-shadow);">
            ${message}
        </div>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 30px; width: 80%; max-width: 300px;">
            <button onclick="window.location.href='index.html'" 
                    style="background: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.3); color: white;">
                EXIT
            </button>
        </div>
    `;
    document.body.appendChild(modal);
}

// 1. CHECK INTERNAL REFERRER (Must come from allowed pages)
const allowedReferrers = ['index', 'home', 'live', 'videos', 'gallery', 'profile'];
const referrer = document.referrer;
let isInternal = false;
if (referrer) {
    if (allowedReferrers.some(path => referrer.includes(path))) {
        isInternal = true;
        sessionStorage.setItem('internalAccess', 'true');
    }
}

// 2. FIREBASE AUTH CHECK
auth.onAuthStateChanged(user => {
    // A. Must be logged in
    if (!user) {
        showAccessDeniedModal("You must be logged in to view this content.");
        return;
    }

    // B. Must have Session Flag (Anti-Copy/Paste)
    // Comment this out if you want to allow direct link sharing for logged in users
    if (!sessionStorage.getItem('internalAccess') && !isInternal) {
        // showAccessDeniedModal("Direct link access is forbidden. Please navigate via Home.");
        // return; 
    }

    // C. Database Permission Check
    db.ref(`page_access/${PAGE_ID}/${user.uid}`).once('value')
    .then(snapshot => {
        const isAllowed = snapshot.val();
        if (isAllowed !== true) {
            showAccessDeniedModal("The Admin has not granted your account access to the " + PAGE_ID.toUpperCase() + " collection.");
        }
    })
    .catch(error => {
        console.error("Check Failed");
        showAccessDeniedModal("Security check failed.");
    });
});

// 3. DISABLE DEVTOOLS (F12, Ctrl+Shift+I, etc)
document.addEventListener('keydown', function(e) {
    if (
        e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && e.key === 'I') || 
        (e.ctrlKey && e.shiftKey && e.key === 'J') || 
        (e.ctrlKey && e.key === 'U')
    ) {
        e.preventDefault();
        alert("Protected Content");
        return false;
    }
});

// 4. DEBUGGER TRAP (Freezes browser if console is opened)
setInterval(function() {
    const start = new Date().getTime();
    debugger; 
    const end = new Date().getTime();
    if (end - start > 100) {
        // If execution took too long, they probably had devtools open
        nukeContent();
        window.location.href = "index.html";
    }
}, 1000);
</script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').then(reg => {
      reg.onupdatefound = () => {
        const newSW = reg.installing;
        newSW.onstatechange = () => {
          if (newSW.state === 'installed' && navigator.serviceWorker.controller) {
            window.location.reload();
          }
        };
      };
    }).catch(err => {});
  }
</script>

<a href="videos.html" class="back-btn">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="white">
    <path d="M15 18l-6-6 6-6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</a>

</body>
</html>
