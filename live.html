<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live | Zone Vault </title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script> 
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<link rel="icon" href="favicon-new.png" type="image/png" />
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<meta name="apple-mobile-web-app-title" content="Zone Vault">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" sizes="192x192" href="favicon-new.png">
<link rel="apple-touch-icon" sizes="512x512" href="favicon-new.png">
<link rel="apple-touch-startup-image" href="splash.png">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-1B2RJ659GL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1B2RJ659GL');
</script>

<script>
  (function() {
    const savedTheme = localStorage.getItem('zoneVaultTheme');
    if(savedTheme) {
      const style = document.createElement('style');
      style.innerHTML = `
        body { 
          background: ${savedTheme} !important; 
          background-size: cover !important;
          background-attachment: fixed !important;
          background-repeat: no-repeat !important;
          min-height: 100vh;
        }
      `;
      document.head.appendChild(style);
    }
  })();
</script>

<style>
  /* --- CSS VARIABLES --- */
  :root {
      --glass-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
      --glass-border: 1px solid rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      --glass-blur: blur(20px);
      --text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        
      --plyr-color-main: #ff0033; /* Red Accent */
  }

  * { box-sizing: border-box; }

  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: black; /* Fallback */
    text-align: center;
    padding: 20px 0px;
    margin: 0;
    transition: background 0.5s ease;
  }

  .main-layout {
    max-width: 100%;
    margin: 0 auto;
    width: 100%;
    padding: 0 20px; 
  }

  .video-wrapper-left {
    width: 100%;
    position: relative; 
  }

  #poster-container {
    width: 100%;
    aspect-ratio: 16/9;
    background-size: cover;
    background-position: center;
    /* Default Fallback */
    background-image: url('https://raw.githubusercontent.com/svtzoneph/gallery/main/images/website/jpntour.png'); 
    border-radius: 0px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    box-shadow: var(--glass-shadow);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* --- GLASSMORPHISM POSTER OVERLAY --- */
  #poster-overlay {
    background: rgba(0, 0, 0, 0.5); 
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-top: 1px solid rgba(255, 255, 255, 0.5);
    padding: 15px 25px;
    border-radius: 50px;
    color: white;
    font-weight: bold;
    font-size: 18px;
    pointer-events: none; 
    max-width: 90%;
    text-align: center;
    margin: 0 auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    text-shadow: var(--text-shadow);
    transform: translateZ(0);
    will-change: transform, backdrop-filter;
  }

  #player-container {
    display: none; 
    width: 100%;
    box-shadow: var(--glass-shadow);
    position: relative; 
  }

  h2 {
    font-size: 24px;
    color: white;
    margin-top: 15px;
    margin-bottom: 5px;
    font-weight: 500;
    letter-spacing: 0.5px;
    text-align: left; 
    text-shadow: var(--text-shadow);
  }

  h3.playlist-header {
    color: white; 
    margin-bottom: 15px; 
    font-size: 20px;
    text-shadow: var(--text-shadow);
  }

  @media (max-width: 600px) {
    h2 { font-size: 18px; }
    h3.playlist-header { 
        font-size: 16px; 
        margin-top: 20px; 
        opacity: 0.9;
    }
    #poster-overlay { 
        font-size: 14px; 
        padding: 10px 15px;
        border-radius: 35px;
        border-width: 1px;
    }
    .center-logo img { width: 40px; }
  }

  .center-logo { display: flex; justify-content: center; margin-bottom: 20px; }
  .center-logo img { width: 50px; height: auto; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); }

  .plyr {
    width: 100%;
    aspect-ratio: 16/9;
    background: #000;
    border-radius: 0px;
    overflow: hidden;
  }
    
  video { width: 100%; }

  /* --- GLASSMORPHISM BACK BUTTON (Hyper) --- */
  .back-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 50px; height: 50px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-top: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    text-decoration: none; z-index: 3000;
    transition: all 0.3s ease;
    cursor: pointer;
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    transform: translateZ(0);
    will-change: transform;
  }
  .back-btn:hover { 
    background: rgba(255,255,255,0.25); 
    transform: scale(1.1); 
    border-color: white;
  }
  .back-btn svg { display: block; }

/* --- REALISTIC STREAMING CONTROLS (Center Time / Mute Right) --- */
.plyr__controls {
  background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.7) 40%, rgba(0,0,0,0) 100%) !important;
  padding: 20px 15px !important;
  display: flex !important;
  align-items: center;
  position: relative; 
}
.plyr__volume { margin-left: auto !important; }
.plyr__time {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-family: 'Roboto Mono', 'Courier New', monospace;
  font-weight: 700;
  font-size: 14px;
  color: rgba(255,255,255,0.95);
  text-shadow: 0 2px 2px rgba(0,0,0,0.8);
  pointer-events: none; 
  margin: 0 !important;
}
.plyr__time--current { left: 50%; transform: translate(-100%, -50%); padding-right: 5px; }
.plyr__time--duration { left: 50%; transform: translate(0, -50%); padding-left: 5px; }
.plyr__time--duration::before { content: "/"; position: absolute; left: -4px; color: rgba(255,255,255,0.5); }
.plyr__control {
  background: transparent;
  border-radius: 8px !important;
  transition: transform 0.2s ease, background 0.2s ease;
  padding: 7px !important;
}
.plyr__control:hover { background: rgba(255, 255, 255, 0.2) !important; transform: scale(1.15); }
.plyr__control svg { filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)); }
.plyr__control--overlaid {
  background: rgba(255, 255, 255, 0.1) !important;
  border: 1px solid rgba(255,255,255,0.4);
  backdrop-filter: blur(8px);
  width: 70px; height: 70px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.3);
}
.plyr__control--overlaid:hover {
  background: var(--plyr-color-main) !important;
  border-color: var(--plyr-color-main);
  transform: scale(1.1);
}
.plyr__captions {
  font-family: 'Segoe UI', sans-serif;
  font-size: 18px;
  font-weight: 600;
  text-shadow: 0 0 4px black, 0 0 8px black;
  padding-bottom: 60px !important; 
}
.plyr__caption { background: transparent !important; }

  /* --- GLASSMORPHISM SEEK OVERLAY --- */
  .seek-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    opacity: 0;
    pointer-events: none;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    background-color: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 80px;
    height: 80px;
    z-index: 20; 
    will-change: transform, opacity;
  }
  .seek-overlay.visible {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }
  .seek-overlay svg {
    width: 40px;
    height: 40px;
    fill: white;
    display: block;
  }
    
  /* Scrollbar Styling */
  #playlist-items::-webkit-scrollbar { width: 8px; }
  #playlist-items::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 4px; }
  #playlist-items::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 4px; border: 1px solid rgba(0,0,0,0.2); }
  #playlist-items::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.5); }

  /* =========================================================================
     --- NEW: GRID PLAYLIST LAYOUT (Card Style) ---
     ========================================================================= */
  #playlist-items {
      display: grid !important;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Responsive Grid */
      gap: 15px;
      padding-right: 10px;
      padding-bottom: 20px;
      max-height: 500px !important; /* Made taller for grid */
  }

  .playlist-item {
      display: flex;
      flex-direction: column; /* Stack text vertically */
      align-items: center;
      justify-content: center;
      background: rgba(30, 30, 30, 0.6); /* Darker card background */
      padding: 30px 20px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      min-height: 240px; /* Increased height to fit Title & Time */
      text-align: center;
      position: relative;
      /* Default cursor for the card itself */
      cursor: default;
  }

  .playlist-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border-color: rgba(255, 255, 255, 0.3);
      background: rgba(45, 45, 45, 0.8);
  }

  .playlist-item.locked {
      opacity: 0.5;
      filter: grayscale(1);
      cursor: not-allowed;
  }

  /* --- TEXT STYLES (Matches Screenshot) --- */
   
  /* 1. Top Status (Small, Uppercase) */
  .card-top-text {
      font-size: 13px;
      color: #aaaaaa; /* Light gray */
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      font-weight: 600;
  }

  /* 2. NEW: Card Title (Main Title stays visible) */
  .card-title-text {
      font-size: 16px;
      color: #ffffff;
      font-weight: 700;
      margin-bottom: 15px;
      line-height: 1.3;
      text-shadow: 0 1px 3px rgba(0,0,0,0.6);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
  }

  /* 3. Middle Date */
  .card-main-date {
      font-size: 24px;
      font-weight: 800;
      color: white;
      margin-bottom: 5px;
      line-height: 1.2;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  }

  /* 4. Time Text */
  .card-time {
      font-size: 16px;
      font-weight: 700;
      color: #fff; 
      margin-bottom: 25px; /* Space before button */
      text-transform: uppercase;
      text-shadow: 0 1px 2px rgba(0,0,0,0.8);
      opacity: 0.9;
  }

  /* 5. Watch Now Button */
  .watch-btn {
      width: 100%;
      padding: 12px 0;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #e0e0e0;
      font-weight: 700;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      border-radius: 6px;
      transition: all 0.2s ease;
      /* Ensure pointer is on the button */
      cursor: pointer;
  }

  /* Button turns RED on hover */
  .playlist-item:hover .watch-btn {
      background: var(--plyr-color-main); /* Your Red Color */
      border-color: var(--plyr-color-main);
      color: white;
      box-shadow: 0 0 15px rgba(255, 0, 51, 0.4);
  }
   
  /* ========================================================================= */

  /* --- STATUS BADGE DESIGNS (Still used for internal logic) --- */
  .status-badge {
    font-size: 10px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 3px 8px;
    border-radius: 4px;
    margin-top: 6px;
    width: fit-content;
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    transition: all 0.3s ease;
  }
  .status-live {
    background: rgba(255, 0, 0, 0.3); 
    color: #ff4444;
    border: 1px solid rgba(255, 68, 68, 0.3);
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.2);
    animation: livePulse 2s infinite;
  }
  .status-replay {
    background: rgba(255, 255, 255, 0.1);
    color: #ccc;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  /* --- MODIFIED: ID BADGE (Transparent & Bottom) --- */
  .status-uid {
    background: rgba(0, 0, 0, 0.20); 
    color: rgba(255, 255, 255, 0.7); 
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-family: monospace; 
    text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(5px);
    text-transform: none !important;
  }

  @keyframes livePulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.4); border-color: rgba(255, 68, 68, 0.4); }
    70% { box-shadow: 0 0 0 6px rgba(255, 68, 68, 0); border-color: rgba(255, 68, 68, 0.1); }
    100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); border-color: rgba(255, 68, 68, 0.4); }
  }

  /* --- PLAYER OVERLAY STATUS BADGE (FIXED POSITION) --- */
  #player-status-badge {
    position: absolute;
    top: auto;      
    bottom: 15px !important;  /* Pushed way down */
    left: 15px !important;   /* Slight padding from left */
    z-index: 100;
    display: none;
    pointer-events: none;
    font-size: 10px; 
    padding: 3px 8px;
    opacity: 0.5;            /* 50% Transparent */
  }

  /* --- PLAYER OVERLAY TITLE --- */
  .player-overlay-title {
    position: absolute;
    top: 10px; 
    left: 0; 
    right: 0;
    text-align: center;
    color: white;
    font-size: 18px;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    pointer-events: none;
    z-index: 100;
    opacity: 0; /* Hidden by default */
    transform: translateY(-10px);
    transition: all 0.3s ease;
    padding: 0 60px; /* Space to avoid overlap */
  }
  .player-overlay-title.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* --- BUFFERING OVERLAY STYLES --- */
  .buffering-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 50;
    pointer-events: none;
    display: none; 
  }
  .buffering-overlay.visible {
    display: block;
  }
  .spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: var(--plyr-color-main);
    animation: spin 1s ease-in-out infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* --- REALTIME VIEW COUNTER STYLES (UPDATED FOR ROW LAYOUT) --- */
  /* Wrapper for Views + Date */
  .video-meta-row {
      display: flex;
      justify-content: space-between; /* Views left, Date right */
      align-items: center;
      margin-top: 15px;
      margin-bottom: 5px;
      padding: 0 5px;
      width: 100%;
  }

  .views-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 8px;
    /* Removed Margins here as they are handled by wrapper */
    margin: 0 !important;
    color: #a1a1a1; 
    font-family: 'Segoe UI', sans-serif;
    font-size: 14px;
    font-weight: 500;
    opacity: 0; 
    transition: opacity 0.5s ease;
  }
  .views-container.visible {
    opacity: 1;
  }
  .views-icon {
    width: 18px;
    height: 18px;
    fill: #a1a1a1; 
  }

  /* --- NEW: DATE DISPLAY STYLE --- */
  .date-display {
    color: #a1a1a1;
    font-family: 'Segoe UI', sans-serif;
    font-size: 14px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* --- LIVE CONTROL BADGE STYLES (In Player) --- */
  .live-control-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 0, 0, 0.15);
    border: 1px solid rgba(255, 0, 0, 0.4);
    color: #ff4444;
    font-size: 10px;
    font-weight: 800;
    padding: 2px 8px;
    border-radius: 4px;
    margin-left: 10px;
    pointer-events: none;
    height: 24px;
    user-select: none;
  }
  .live-dot {
    width: 6px;
    height: 6px;
    background: #ff4444;
    border-radius: 50%;
    box-shadow: 0 0 8px #ff4444;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(0.95); opacity: 0.7; }
    50% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(0.95); opacity: 0.7; }
  }

  @media (max-width: 600px) {
    #player-status-badge {
        /* Mobile adjustment for ID */
        bottom: 5px !important; 
        left: 5px !important;
        font-size: 8px !important;
    }
    .player-overlay-title {
        font-size: 14px;
        top: 15px;
        padding: 0 40px;
    }
    .live-control-badge {
        font-size: 9px;
        padding: 1px 6px;
        height: 20px;
        margin-left: 6px;
    }
  }

  @media (min-width: 900px) {
    .main-layout {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 10px; 
      padding: 0 20px; 
      text-align: left;
    }
    .video-wrapper-left { flex: 2; }
    #playlist { flex: 1; margin-top: 0 !important; margin-bottom: 0 !important; max-width: none !important; }
    h3.playlist-header { margin-top: 0 !important; line-height: 1; }
    #playlist-items { 
        max-height: 500px !important; 
        padding-right: 10px;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
    }
  }
</style>
</head>

<body>

<div class="center-logo">
  <img src="https://uploads.onecompiler.io/43ddry4jt/43s3sjvch/Zone%20Vault%20logo.png" loading="lazy" alt="Zone Vault Logo">
</div>

<div class="main-layout">

  <div class="video-wrapper-left">
    
    <div id="poster-container">
      
    </div>

    <div id="player-container">
      <div id="player-status-badge" class="status-badge"></div>
      <div id="player-overlay-title" class="player-overlay-title"></div>
      
      <div id="buffering-overlay" class="buffering-overlay">
        <div class="spinner"></div>
      </div>
      
      <div class="plyr__video-wrapper">
        <video id="videoPlayer" playsinline controls crossorigin="anonymous"></video>
      </div>
    </div>

    <div class="video-meta-row">
        <div id="views-display" class="views-container">
          <svg class="views-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          <span id="view-count-text">0</span>
        </div>
        
        <div id="current-date-text" class="date-display"></div>
    </div>

    <h2 id="main-title">Select Live</h2>
  </div>

  <div id="playlist" style="width: 100%; max-width: 1000px; margin: 20px auto; text-align: left;">
    
    <div id="playlist-items">
      <div style="text-align:center; color:white; padding:20px;">Loading Event Data...</div>
    </div>
  </div>

</div> 

<script>
// --- INITIALIZE FIREBASE FIRST ---
const firebaseConfig = {
  apiKey: "AIzaSyAs2S6iRhnYhmqNuF0QCCYu5NuzxHxIRv0",
  authDomain: "tvnstream-b4497.firebaseapp.com",
  databaseURL: "https://tvnstream-b4497-default-rtdb.firebaseio.com",
  projectId: "tvnstream-b4497",
  storageBucket: "tvnstream-b4497.appspot.com",
  messagingSenderId: "308384754214",
  appId: "1:308384754214:web:2938e76cd29b288f75d4e7",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth(); 
const db = firebase.database();

// --- 1. CONFIGURATION & DATA (UPDATED FOR FIREBASE CONTROL PANEL) ---
window.playlistData = []; // Global Storage for loaded data
let initialLoadComplete = false;

const playlistContainer = document.getElementById('playlist-items');
const posterContainer = document.getElementById('poster-container');
const playerContainer = document.getElementById('player-container');
const mainTitle = document.getElementById('main-title');
const playerBadge = document.getElementById('player-status-badge');
const overlayTitle = document.getElementById('player-overlay-title'); 

// NEW: Globals for Views and Buffering
const bufferingOverlay = document.getElementById('buffering-overlay');
const viewsDisplay = document.getElementById('views-display');
const viewCountText = document.getElementById('view-count-text');
const dateDisplayText = document.getElementById('current-date-text'); // Global Date Ref

let currentViewListenerRef = null;
let currentPresenceRef = null; // New for Presence

// Global variable to store current ep data
window.currentEpData = null;

// ==========================================================
// --- NEW: FIREBASE PLAYLIST LISTENER (Control Panel) ---
// ==========================================================
db.ref('event_playlist').on('value', (snapshot) => {
    // 1. Clear current list
    playlistContainer.innerHTML = '';
    
    const data = snapshot.val();
    // Convert object to array and sort by ID
    const playlistArray = data ? Object.values(data).sort((a, b) => a.id - b.id) : [];
    
    // Update global data
    window.playlistData = playlistArray; 

    // --- AUTO UPDATE POSTER (NEW FEATURE) ---
    // If we have data, set the main poster to the first item's image
    // (This ensures when page loads, you see the thumbnail of the first video)
    if(playlistArray.length > 0) {
       const firstEp = playlistArray[0];
       if(firstEp.image) {
           document.getElementById('poster-container').style.backgroundImage = `url('${firstEp.image}')`;
       }
    }

    if(playlistArray.length === 0) {
        playlistContainer.innerHTML = '<div style="color:white; text-align:center; padding:20px;">No events scheduled.</div>';
    }

    // 2. Build the UI
    playlistArray.forEach(ep => {
      // Create Card Container
      const epDiv = document.createElement('div');
      epDiv.className = 'playlist-item';
       
      const today = new Date();
      let isLocked = false;
      
      // LOGIC: Check Date OR Explicit "LOCKED" status
      if (ep.date && new Date(ep.date) > today) isLocked = true;
      if (ep.status === "LOCKED") isLocked = true;

      if (isLocked) {
          epDiv.classList.add('locked');
      }

      // Top Status
      const topText = document.createElement('div');
      topText.className = 'card-top-text';
      topText.textContent = ep.status ? ep.status : ""; 

      // Title
      const titleText = document.createElement('div');
      titleText.className = 'card-title-text';
      titleText.textContent = ep.title;

      // Middle Date
      const dateText = document.createElement('div');
      dateText.className = 'card-main-date';
      dateText.textContent = ep.date ? ep.date : "STREAMING NOW";

      // Time Text
      const timeText = document.createElement('div');
      timeText.className = 'card-time';
      timeText.textContent = ep.time ? ep.time : ""; 

      // "WATCH NOW" Button
      const btn = document.createElement('div');
      btn.className = 'watch-btn';
      
      if (isLocked) {
          btn.textContent = "LOCKED";
      } else {
          btn.textContent = "WATCH NOW";
      }

      // Append elements
      epDiv.appendChild(topText);
      epDiv.appendChild(titleText); 
      epDiv.appendChild(dateText);
      epDiv.appendChild(timeText);
      epDiv.appendChild(btn);

      // --- UPDATED: CLICK EVENT IS NOW ON THE BUTTON ONLY ---
      btn.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevents clicks from affecting parent elements if needed

        if (ep.status === "NOT AVAILABLE") {
            alert("This episode is currently unavailable.");
            return;
        }
        if (isLocked) {
            alert(`This event starts on: ${ep.date}`);
            return;
        }
        
        loadAndPlayEpisode(ep.id, true);
        
        // Auto-scroll to player on mobile
        if(window.innerWidth < 900) {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
      });

      playlistContainer.appendChild(epDiv);
    });

    // --- CHECK FOR AUTO-PLAY LINK ONCE DATA IS LOADED ---
    if (!initialLoadComplete) {
        checkAutoPlay();
        initialLoadComplete = true;
    }
});

// =========================================================================
// !!! ðŸš¨ START OF PAGE-LEVEL SECURITY SCRIPT (REAL-TIME) ðŸš¨ !!!
// =========================================================================

const PAGE_ID = "jpnnewtour"; 

// --- SMART GO BACK FUNCTION (Centralized) ---
function smartGoBack() {
    if (document.referrer && window.history.length > 1) {
        window.history.back();
    } else {
        window.location.href = 'videos.html';
    }
}

// Function to show the denial screen
function showAccessDeniedModal(message) {
    if(typeof player !== 'undefined') {
        player.pause();
        if(player.fullscreen.active) player.fullscreen.exit();
    }

    document.body.style.overflow = 'hidden';

    if(document.querySelector('.access-denied-modal')) return;

    const modal = document.createElement('div');
    modal.className = 'access-denied-modal';
    modal.style.opacity = '1';
    modal.style.animation = 'none';

    modal.innerHTML = `
        <strong style="color: #FF4444; font-size: 36px; margin-bottom: 20px;">Access Denied</strong>
        <div style="margin-top: 15px; font-size: 18px; max-width: 90%; line-height: 1.4; text-shadow: var(--text-shadow);">
            ${message}
        </div>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 30px; width: 80%; max-width: 300px;">
            <button onclick="smartGoBack()" 
                    style="background: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.3); color: white;">
                GO BACK
            </button>
        </div>
    `;
    document.body.appendChild(modal);
}

// Function to remove modal (if access is given back in real-time)
function removeAccessDeniedModal() {
    const modal = document.querySelector('.access-denied-modal');
    if(modal) {
        modal.remove();
        document.body.style.overflow = 'auto';
    }
}

// Check on page load AND listen for changes
auth.onAuthStateChanged(user => {
    if (!user) {
        showAccessDeniedModal("You must be logged in to view this content.");
        return;
    }

    // Set Badge UID
    if(playerBadge) {
        playerBadge.textContent = "ID: " + user.uid;
        playerBadge.style.display = "block"; 
        playerBadge.classList.add('status-uid');
    }

    // --- REALTIME LISTENER (.on instead of .once) ---
    const accessRef = db.ref(`page_access/${PAGE_ID}/${user.uid}`);
      
    accessRef.on('value', (snapshot) => {
        const isAllowed = snapshot.val();
        
        // If value is TRUE, they are allowed.
        if (isAllowed === true) {
            console.log("Access Granted/Verified for:", user.uid);
            removeAccessDeniedModal(); // Unblock if they were blocked
        } else {
            // Immediate Block
            console.warn("Access Revoked in Realtime");
            showAccessDeniedModal(
                "<span style='color: red; font-weight: bold;'>You have violated Admin rules.</span><br>" +
                "Your access to this stream has been revoked.<br><br>" +
                "Please message us if you are sure this is an error.<br>" +
                "Your UID: <small>" + user.uid + "</small>"
            );
        }
    });
});
// =========================================================================
// !!! ðŸš¨ END OF PAGE-LEVEL SECURITY SCRIPT ðŸš¨ !!!
// =========================================================================

const video = document.getElementById("videoPlayer");
let hls;

// --- PLYR CONFIG UPDATED: Order adjusted for Layout ---
const player = new Plyr(video, {
  captions: { active: true, update: true, language: "en" },
  controls: [
    'play-large',   
    'play',         
    'mute',
    'fullscreen'
  ],
  settings: ["captions","speed","quality"],
  clickToPlay: false, 
  dblclickFullscreen: false
});

// --- HELPER: UPDATE LIVE BADGE IN PLAYER ---
function updatePlayerLiveBadge(status) {
    if (!player || !player.elements || !player.elements.controls) return;
    const controls = player.elements.controls;
    let badge = controls.querySelector('.live-control-badge');

    if(status && status.toUpperCase() === 'LIVE') {
        if(!badge) {
            badge = document.createElement('div');
            badge.className = 'live-control-badge';
            badge.innerHTML = '<span class="live-dot"></span>LIVE';
            
            // Try to find the Play button (small one) to insert after
            const playBtn = controls.querySelector('[data-plyr="play"]');
            if(playBtn) {
                playBtn.after(badge);
            } else {
                // Fallback: prepend to volume or controls
                controls.insertBefore(badge, controls.firstChild);
            }
        }
        badge.style.display = 'flex';
    } else {
        if(badge) badge.style.display = 'none';
    }
}

// --- 2. CORE FUNCTION: PLAY EPISODE ---
function loadAndPlayEpisode(epId, updateUrl = true) {
    // USE GLOBAL DATA NOW
    const ep = window.playlistData.find(item => item.id === epId);
    
    if (!ep) {
        console.warn("Episode ID not found:", epId);
        return;
    }

    const today = new Date();
    // Allow playing if it's Live or Replay even if date is passed, 
    // but block future dates if status is NOT live
    if (ep.date && ep.status !== 'LIVE' && ep.status !== 'REPLAY') {
        const releaseDate = new Date(ep.date);
        if (releaseDate > today) {
            alert(`\nLIVE STREAM DATE: ${ep.date}`);
            return; 
        }
    }

    if (updateUrl) {
        // --- MODIFIED: Use Title Slug for URL instead of ID ---
        const titleSlug = encodeURIComponent(ep.title.trim().replace(/\s+/g, '-'));
        const newUrl = window.location.pathname + '?v=' + titleSlug;
        
        // 2. Push state (we keep ID in the state object for history navigation)
        history.pushState({id: ep.id}, '', newUrl);
    }

    // D. Set Data & UI
    window.currentEpData = ep;
    
    // --- UPDATED POSTER LOGIC ---
    // Change the poster immediately based on the selected episode
    if(ep.image) {
        document.getElementById('poster-container').style.backgroundImage = `url('${ep.image}')`;
        // Also update Plyr poster just in case
        player.poster = ep.image;
    }

    // Update Overlay Title
    if(overlayTitle) {
        overlayTitle.textContent = ep.title;
    }

    // Update Live Badge in Player Controls
    updatePlayerLiveBadge(ep.status);
    
    // --- NEW: UPDATE DATE DISPLAY TO MATCH EPISODE ---
    if(dateDisplayText) {
        // Uses the date string from your data (e.g. "December 1, 2025")
        dateDisplayText.textContent = ep.date ? ep.date : ""; 
    }

    posterContainer.style.display = "none";
    playerContainer.style.display = "block";

    // =========================================================
    // --- LIVE VIEWERS LOGIC (Presence System) ---
    // =========================================================
    
    const user = auth.currentUser;

    // 1. CLEANUP: If user was watching another video, remove them from that count
    if (currentPresenceRef) {
        currentPresenceRef.remove(); // Remove from DB
        currentPresenceRef.onDisconnect().cancel(); // Cancel auto-remove for old reference
        currentPresenceRef = null;
    }

    // 2. CLEANUP: Stop listening to the old video's count
    if (currentViewListenerRef) {
        currentViewListenerRef.off(); 
    }

    if (user) {
        // 3. PRESENCE: Add user to 'active_viewers' for this episode
        const presencePath = `active_viewers/${epId}/${user.uid}`;
        currentPresenceRef = db.ref(presencePath);

        // a. Tell Firebase: "If I disconnect (close tab/internet loss), remove this node"
        currentPresenceRef.onDisconnect().remove();

        // b. Add myself to the list right now
        currentPresenceRef.set({
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            device: navigator.userAgent
        });
    }

    // 4. LISTEN: Count how many children are in this episode's folder
    const viewsRef = db.ref(`active_viewers/${epId}`);
    currentViewListenerRef = viewsRef;
      
    currentViewListenerRef.on('value', (snapshot) => {
        const viewersData = snapshot.val();
        // If data exists, count keys. If null, count is 0.
        const count = viewersData ? Object.keys(viewersData).length : 0;
        
        // Format number (e.g., 1,234)
        viewCountText.textContent = new Intl.NumberFormat().format(count) + "";
        viewsDisplay.classList.add('visible');
    });
    // =========================================================

    db.ref(`live/${ep.id}`).once('value').then(snapshot => {
      const data = snapshot.val();
      if(!data || !data.url) { alert("Live unavailable"); return; }

      if(typeof hls !== 'undefined' && hls){ hls.destroy(); hls = null; }

      const resumePlayback = () => {
          // --- FIX: FORCE SOUND ON ---
          player.volume = 1;    // Set volume to 100%
          player.muted = false; // Force Unmute
          // ---------------------------

          if (!window.currentEpData || !user) {
             var playPromise = player.play();
             if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Autoplay blocked.");
                });
             }
             return;
          }
          db.ref('watchHistory/' + user.uid + '/' + window.currentEpData.id).once('value').then(snap => {
              const saved = snap.val();
              if (saved && saved.currentTime > 0) {
                  player.currentTime = saved.currentTime;
              }
              
              var playPromise = player.play();
              if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Autoplay blocked.");
                });
              }
          });
      };

      if(typeof Hls !== 'undefined' && Hls.isSupported()){
        hls = new Hls();
        hls.loadSource(data.url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => { 
              setTimeout(resumePlayback, 100);
        });
      } else {
        video.src = data.url;
        video.addEventListener('loadedmetadata', resumePlayback, { once: true });
      }

      video.querySelectorAll("track").forEach(t => t.remove());
      if(data.subtitles){
        Object.entries(data.subtitles).forEach(([lang,url])=>{
          const track = document.createElement("track");
          track.kind = "subtitles";
          track.label = lang.toUpperCase();
          track.srclang = lang;
          track.src = url;
          if(lang==="en") track.default = true;
          video.appendChild(track);
        });
      }
      
      if(data.title){
        mainTitle.textContent = data.title;
        // Update overlay title if dynamic
        if(overlayTitle) overlayTitle.textContent = data.title;
      } else {
        mainTitle.textContent = ep.title;
      }

    }).catch(err => console.error("Firebase Error:", err));
}

// --- 3. HANDLE BROWSER BACK BUTTON ---
window.addEventListener('popstate', (event) => {
    if (event.state && event.state.id) {
        loadAndPlayEpisode(event.state.id, false);
    } else {
        posterContainer.style.display = "flex";
        playerContainer.style.display = "none";
        player.pause();
    }
});

// --- 5. CHECK URL ON PAGE LOAD (Moved to Logic function) ---
function checkAutoPlay() {
    auth.onAuthStateChanged(user => {
        if(user) {
            const urlParams = new URLSearchParams(window.location.search);
            const videoParam = urlParams.get('v'); // This is the Title Slug
            let urlChanged = false;

            // 1. ADD USER ID (If missing or incorrect)
            if (user.uid && urlParams.get('id') !== user.uid) {
                urlParams.set('id', user.uid);
                urlChanged = true;
            }

            // 2. ADD SESSION ID (Time/Date Timestamp)
            if (!urlParams.has('session')) {
                const timeSessionID = Date.now();
                urlParams.set('session', timeSessionID);
                urlChanged = true;
            }

            // Apply changes to URL bar without refreshing
            if (urlChanged) {
                const newUrl = window.location.pathname + '?' + urlParams.toString();
                history.replaceState(null, '', newUrl);
            }
            
            // --- VIDEO PLAYING LOGIC ---
            if (videoParam && window.playlistData.length > 0) {
                // Find the episode where the formatted title matches the URL
                const foundEp = window.playlistData.find(item => {
                    const itemSlug = encodeURIComponent(item.title.trim().replace(/\s+/g, '-'));
                    return itemSlug === videoParam;
                });

                // Fallback: Check ID just in case old links are used
                const foundEpById = window.playlistData.find(item => item.id === videoParam);

                const targetEp = foundEp || foundEpById;

                if (targetEp) {
                    setTimeout(() => {
                        console.log("Auto-playing from Link:", targetEp.title);
                        loadAndPlayEpisode(targetEp.id, false); 
                    }, 500);
                } else {
                    console.warn("No episode found for:", videoParam);
                }
            }
        }
    });
}

const isMobileOrTablet = /Mobi|Android|iPad|Tablet/i.test(navigator.userAgent);

function enterFullscreen(el) {
  if (el.requestFullscreen) el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
  else if (el.msRequestFullscreen) el.msRequestFullscreen();
}

player.on('enterfullscreen', () => {
  if (isMobileOrTablet) {
    if (screen.orientation && screen.orientation.lock) {
      screen.orientation.lock('landscape').catch(err => {});
    } else if (window.screen.lockOrientation) {
      window.screen.lockOrientation('landscape');
    }
  }
});

player.on('exitfullscreen', () => {
  if (isMobileOrTablet) {
    if (screen.orientation && screen.orientation.unlock) {
      screen.orientation.unlock();
    }
  }
});

// --- NEW: BUFFERING EVENTS & OVERLAY MANAGEMENT ---
player.on('waiting', () => {
    if (bufferingOverlay) bufferingOverlay.classList.add('visible');
});

player.on('playing', () => {
    if (bufferingOverlay) bufferingOverlay.classList.remove('visible');
});

player.on('pause', () => {
    // Hide spinner if user manually pauses
    if (bufferingOverlay) bufferingOverlay.classList.remove('visible');
});

player.on('canplay', () => {
    if (bufferingOverlay) bufferingOverlay.classList.remove('visible');
});

player.on('ready', () => {
    const videoContainer = player.elements.container;
    const videoWrapper = videoContainer.querySelector('.plyr__video-wrapper');
    if (!videoWrapper) return;
    
    // --- MOVE ELEMENTS INTO WRAPPER (So they appear in Fullscreen) ---
    const badge = document.getElementById('player-status-badge');
    const overlayTitle = document.getElementById('player-overlay-title');
    const buffer = document.getElementById('buffering-overlay');
    
    if(badge) videoWrapper.appendChild(badge);
    if(overlayTitle) videoWrapper.appendChild(overlayTitle);
    if(buffer) videoWrapper.appendChild(buffer);

    // --- SYNC TITLE VISIBILITY WITH CONTROLS ---
    // Show title when controls are shown
    player.on('controlsshown', () => {
        if(overlayTitle) overlayTitle.classList.add('visible');
    });

    // Hide title when controls are hidden
    player.on('controlshidden', () => {
        if(overlayTitle && !player.paused) { 
            // Only hide if playing. If paused, we keep info visible.
            overlayTitle.classList.remove('visible');
        }
    });
    
    // Initial State: Show title
    if(overlayTitle) overlayTitle.classList.add('visible');

    // --- DOUBLE TAP LOGIC ---
    const rewindIcon = document.getElementById('rewind-icon-overlay');
    const forwardIcon = document.getElementById('forward-icon-overlay');
    const playPauseIcon = document.getElementById('play-pause-icon-overlay');
    const playSvg = document.getElementById('svg-play') ? document.getElementById('svg-play').cloneNode(true) : null;
    const pauseSvg = document.getElementById('svg-pause') ? document.getElementById('svg-pause').cloneNode(true) : null;
    
    if(playSvg) playSvg.style.display = 'block';
    if(pauseSvg) pauseSvg.style.display = 'block';

    if (rewindIcon) videoWrapper.appendChild(rewindIcon);
    if (forwardIcon) videoWrapper.appendChild(forwardIcon);
    if (playPauseIcon) videoWrapper.appendChild(playPauseIcon);

    let lastTapTime = 0, tapTimeout = null, iconHideTimeout = null;

    function showSeekIcon(type) {
        if (iconHideTimeout) clearTimeout(iconHideTimeout);
        if(rewindIcon) rewindIcon.classList.remove('visible');
        if(forwardIcon) forwardIcon.classList.remove('visible');
        if(playPauseIcon) playPauseIcon.classList.remove('visible');

        let iconToShow;
        if (type === 'rewind') iconToShow = rewindIcon;
        else if (type === 'forward') iconToShow = forwardIcon;
        else if (type === 'play-pause') {
            iconToShow = playPauseIcon;
            if(playPauseIcon) {
                playPauseIcon.innerHTML = '';
                if (player.paused && pauseSvg) playPauseIcon.appendChild(pauseSvg); 
                else if (!player.paused && playSvg) playPauseIcon.appendChild(playSvg);
            }
        }
        if (iconToShow) {
            iconToShow.classList.add('visible');
            iconHideTimeout = setTimeout(() => { iconToShow.classList.remove('visible'); }, 500);
        }
    }

    function handleDoubleTap(event) {
        const rect = videoWrapper.getBoundingClientRect();
        const tapX = event.clientX - rect.left;
        const zoneWidth = rect.width;
        if (tapX < zoneWidth * 0.35) { player.rewind(10); showSeekIcon('rewind'); }
        else if (tapX > zoneWidth * 0.65) { player.forward(10); showSeekIcon('forward'); }
        else { showSeekIcon('play-pause'); player.togglePlay(); }
    }

    videoWrapper.addEventListener('click', (event) => {
        if (event.target.closest('.plyr__controls')) return;
        event.stopPropagation();
        const currentTime = new Date().getTime();
        const timeSinceLastTap = currentTime - lastTapTime;
        if (tapTimeout) { clearTimeout(tapTimeout); tapTimeout = null; }

        if (timeSinceLastTap > 0 && timeSinceLastTap < 300) {
            event.preventDefault(); handleDoubleTap(event); lastTapTime = 0;
        } else {
            event.preventDefault();
            tapTimeout = setTimeout(() => { player.toggleControls(); }, 300);
        }
        lastTapTime = currentTime;
    });

    videoWrapper.addEventListener('dblclick', (e) => { e.preventDefault(); e.stopPropagation(); });
});

// --- CLOUD SAVING LOGIC ---
let lastSaveTime = 0; 

player.on("timeupdate", () => {
    const user = auth.currentUser;
    const now = Date.now();
    if (user && window.currentEpData && !player.paused && player.currentTime > 5) {
        if (now - lastSaveTime > 5000) { 
            let path = window.location.pathname;
            let pageName = path.substring(path.lastIndexOf('/') + 1);
            if(!pageName) pageName = "videos.html"; 

            const dataToSave = {
                id: window.currentEpData.id,
                title: window.currentEpData.title,
                image: window.currentEpData.image,
                currentTime: player.currentTime,
                duration: player.duration || 0,
                timestamp: now,
                page: pageName 
            };
              
            db.ref('watchHistory/' + user.uid + '/' + window.currentEpData.id).update(dataToSave);
            lastSaveTime = now;
        }
    }
});

// --- REMOVE VIEWER ON TAB CLOSE ---
window.addEventListener('beforeunload', () => {
    if (currentPresenceRef) {
        currentPresenceRef.remove();
    }
});
</script>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').then(reg => {
      reg.onupdatefound = () => {
        const newSW = reg.installing;
        newSW.onstatechange = () => {
          if (newSW.state === 'installed' && navigator.serviceWorker.controller) {
            window.location.reload();
          }
        };
      };
    }).catch(err => {});
  }
</script>

<style>
  /* Access Denied Modal - Hyper Glass */
  .access-denied-modal {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.85); 
    color: #fff;
    font-family: 'Segoe UI', Arial, sans-serif;
    display: flex; align-items: center; justify-content: center;
    z-index: 11000; text-align: center; padding: 20px;
    opacity: 0; animation: fadeIn 0.5s forwards; flex-direction: column;
    backdrop-filter: blur(15px);
    transform: translateZ(0);
    will-change: opacity, backdrop-filter;
  }
  .access-denied-modal strong { font-size: 24px; margin-bottom: 10px; text-shadow: var(--text-shadow); }
  .access-denied-modal button {
    margin-top: 15px; padding: 10px 25px; 
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.3);
    color: white; border-radius: 50px;
    cursor: pointer; font-weight: bold; transition: all 0.3s ease;
    backdrop-filter: blur(5px);
  }
  .access-denied-modal button:hover { background: rgba(255,255,255,0.25); color: white; }
  @keyframes fadeIn { to { opacity: 1; } }
</style>

<a href="#" onclick="smartGoBack(); return false;" class="back-btn">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="white">
    <path d="M15 18l-6-6 6-6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</a>

<div id="rewind-icon-overlay" class="seek-overlay">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.9998 1.5V6.4428C5.5598 6.9048 2.4418 10.3368 2.4418 14.8828C2.4418 19.8288 6.4418 23.8288 11.3878 23.8288C15.8278 23.8288 19.4678 20.4968 20.0758 16.1988H17.5558C17.0098 18.9888 14.4838 21.3288 11.3878 21.3288C7.8118 21.3288 4.9418 18.4588 4.9418 14.8828C4.9418 11.6688 7.3738 9.0708 10.4998 8.6148V13.4998L17.4998 7.4998L9.9998 1.5Z"/></svg>
</div>
<div id="forward-icon-overlay" class="seek-overlay">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.0002 1.5L6.50016 7.49984L14.0002 13.4998V8.61484C17.1262 9.07084 19.5582 11.6688 19.5582 14.8828C19.5582 18.4588 16.6882 21.3288 13.1122 21.3288C10.0162 21.3288 7.49016 18.9888 6.94416 16.1988H4.42416C5.03216 20.4968 8.67216 23.8288 13.1122 23.8288C18.0582 23.8288 22.0582 19.8288 22.0582 14.8828C22.0582 10.3368 18.9402 6.90484 14.5002 6.44284V1.5Z"/></svg>
</div>
<div id="play-pause-icon-overlay" class="seek-overlay"></div>

<svg id="svg-play" style="display: none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5.14V19.14L19 12.14L8 5.14Z"/></svg>
<svg id="svg-pause" style="display: none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19H10V5H6V19ZM14 5V19H18V5H14Z"/></svg>

<script>
  const allowedPaths = [
    '/index.html',
    '/home.html',
    '/nanabnb.html',
    '/newtour.html',
    '/hxwfanconcert.html',
    '/svtholiday.html',
    '/arenatour.html',
    '/svtjapanconcert.html',
    '/touragain.html',
    '/gallery.html',
    '/profile.html',
    '/soon.html'
  ];

  const currentPage = window.location.pathname;

  let hasInternalAccess = sessionStorage.getItem('internalAccess') === 'true';

  const referrer = document.referrer;
  const refPath = referrer ? new URL(referrer).pathname : null;
  const cameFromAllowedPage = refPath && allowedPaths.includes(refPath);

  if (cameFromAllowedPage) {
    sessionStorage.setItem('internalAccess', 'true');
    hasInternalAccess = true;
  }
</script>

<script>
// Content Protection
document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
document.onkeydown = function(e) {
    if(e.keyCode == 123) return false;
    if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false;
    if(e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) return false;
    if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false;
    if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
}
window.ondragstart = function() { return false; } 
document.onselectstart = function() { return false; }
</script>

</body>
</html>
